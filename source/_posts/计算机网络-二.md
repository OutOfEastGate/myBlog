---
title: 计算机网络(二、传输层)
date: 2022-06-14 23:17:22
tags: 计算机网络
categories: 学习笔记-计网/计组/数据库
cover: https://w.wallhaven.cc/full/45/wallhaven-45zdx1.png
---

# 一、传输层

## 1、概述和传输层服务

**传输服务和协议**

-  为运行在不同主机上的应 用进程提供逻辑通信
-  传输协议运行在端系统
   -  发送方：将应用层的报文分成报文段，然后传递给网络层
   -  接收方：将报文段重组成报文，然后传递给应用层
-  有多个传输层协议可供应 用选择如TCP和UDP

**传输层和网络层的区别**

 网络层服务：主机之间 的逻辑通信

 传输层服务：进程间的 逻辑通信

-  传输层依赖于网络层的服务
-  传输层对网络层的服务进行增强（解决数据丢失、顺序混乱、加密等问题），但是对于延时和带宽问题无法增强

把传输层和网络层类比成：2个家庭的通信

Ann家的12个小孩给另Bill家的 12个小孩发信 

- 主机 = 家庭 
- 进程 = 小孩 
- 应用层报文= 信封中的信件 
- 传输协议= Ann 和 Bill 
  - 为家庭小孩提供复用解复用服务 
- 网络层协议 = 邮政服务 
  - 家庭-家庭的邮包传输服务

**Internet传输层协议**

{%tabs 1%}

<!--tab TCP-->

 可靠的、保序的传输： TCP

- 多路复用、解复用
- 拥塞控制
- 流量控制
- 建立连接

<!--endtab-->

<!--tab UDP-->

 不可靠、不保序的传输：UDP

- 多路复用，解复用
- 没有尽力而为的IP服务添加更多的其它额外服务

<!--endtab-->

{%endtabs%}

TCP和UDP都不对延时和带宽提供服务

##  2、多路复用与解复用

{%tabs 1%}

<!--tab 在发送方主机多路复用-->

从多个套接字接收来自多个进程的报文，根据套接字对应的IP地址和 端口号等信息对报文段用头部加以封装 (该头部信息用于以后的解复用)

<!--endtab-->

<!--tab 接收方主机多路解复用-->

根据报文段的头部信息中的IP地址 和端口号将接收到的报文段发给 正确的套接字(和对应的应用进程)

<!--endtab-->

{%endtabs%}

**多路解复用的工作原理**

- 解复用的作用：TCP或者UDP实体采用哪些信息，将报文段的数据部分交给正确的socket，从而交给正确的进程
- 主机收到IP数据报
  - 每个数据报有源IP地址和目标IP地址
  - 每个数据报承载一个传输层报文段
  - 每个报文段有一个源端口号和目标端口号
- 主机联合使用IP地址和端口号将报文段发送给合适的套接字

**无连接(UDP)多路解复用**

 在接收端，UDP套接字用二元 组标识 (目标IP地址、目标端 口号)

-  当主机收到UDP报文段：
   -  检查报文段的目标端口号
   -  用该端口号将报文段定位给 套接字
-  如果两个不同源IP地址/源端口号的数据报，但是有相同的 目标IP地址和端口号，则被定位到相同的套接字

![](https://s1.ax1x.com/2022/06/09/Xys1c6.md.png)

**面向连接(TCP)的多路复用**

 TCP套接字:四元组本地标识：源IP地址、源端口号、目的IP地址、目的端口号

TCP解复用：接收主机用这四个值来将数据报 定位到合适的套接字

-  服务器能够在一个TCP 端口上同时支持多个 TCP套接字：
   -  每个套接字由其四元组标识（有不同的源IP和源 PORT）
-  Web服务器对每个连接客户端有不同的套接字
   -  非持久对每个请求有不同的套接字

![](https://s1.ax1x.com/2022/06/09/Xys3jK.png)

##  3、无连接传输：UDP

UDP: User Datagram Protocol

<img src="https://s1.ax1x.com/2022/06/14/XIa4Mj.png" width="50%" />



**UDP校验**

目的： 检测在被传输报文段中的差错 (如比特反转)

发送方：

-  将报文段的内容视为16 比特的整数
-  校验和：报文段的加法 和 （1的补运算）
-  发送方将校验和放在 UDP的校验和字段

接收方：

-  计算接收到的报文段的校验和
- 检查计算出的校验和与校验 和字段的内容是否相等：
  -  不相等–--检测到差错
  -  相等–--没有检测到差错 ，但也许还是有差错

案例：

![](https://s1.ax1x.com/2022/06/14/XIdaT0.md.png)



## 4、可靠数据传输的原理

开发可靠数据传输协议（ rdt ）reliable data transfer

有限状态机 (FSM)

**确认(ACK)**：接收方显式地告诉发送方分组已被正确接收 

 **否定确认( NAK)**: 接收方显式地告诉发送方分组发生了差错 • 

### rdt2.0

rdt2.0中的新机制：采用差错控制编码进行差错检测 

-  发送方差错控制编码、缓存 
- 接收方使用编码检错 
- 接收方的反馈：控制报文（ACK，NAK）：接收方->发送方 
- 发送方收到反馈相应的动作

存在的问题：

如果ACK/NAK出错？ 发送方不知道接收方发 生了什么事情！

### rdt2.1

**rdt2.1**：发送方处理出错的ACK/NAK

![](https://s1.ax1x.com/2022/07/24/jvpFA0.md.png)



**发送方：**

-  在分组中加入序列号 ， 两个序列号（0，1）就 足够了 ， 一次只发送一个未经确认 的分组。
-  必须检测接收方发过来的ACK/NAK是否 出错
-  状态数变成了两倍（ 必须记住当前分组的序列 号为0还是1）

**接收方：**

-  必须检测接收到的分组 是否是重复的（ 状态会指示希望接收到的 分组的序号为0还是1）
-  注意：接收方并不知道 发送方是否正确收到了 其ACK/NAK（ 没有安排确认的确认）
- 接收方不知道它最后发送的ACK/NAK是否被正确地收到， 也就是发送方不对收到的ack/nak给确认，没有所谓的确认的确认；

### rdt2.2

rdt2.2：无NAK的协议

- 功能同rdt2.1，但只使用ACK(ack 要编号）
- 接收方对最后正确接收的分组发ACK，以替代NAK
  -  接收方必须显式地包含被正确接收分组的序号
-  当收到重复的ACK（如：再次收到ack0）时，发送 方与收到NAK采取相同的动作：重传当前分组
- 为后面的一次发送多个数据单位做一个准备
  -  一次能够发送多个
  -  每一个的应答都有：ACK，NACK；麻烦
  -  使用对前一个数据单位的ACK，代替本数据单位的nak
  -  确认信息减少一半，协议处理简单

![](https://s1.ax1x.com/2022/07/27/vp4mOf.png)

### rdt3.0

rdt3.0：具有比特差错和分组丢失的信道

新的假设：下层信道可 能会丢失分组（数据 或ACK）

![](https://s1.ax1x.com/2022/07/27/vp5oaF.png)

![](https://s1.ax1x.com/2022/07/27/vp5HPJ.png)

-  过早超时（延迟的ACK）也能够正常工作；但是效率较低，一半 的分组和确认是重复的； 
- 设置一个合理的超时时间也是比较重要的

​	

- rdt3.0可以工作，但链路容量比较大的情况下，**性能很差** 

-  链路容量比较大，一次发一个PDU 的不能够充分利用链路的传输能力

**流水线协议**

流水线协议：允许发送方在未得到对方确认的情况下一次发送多个分组

-  必须增加序号的范围:用多个bit表示分组的序号
-  在发送方/接收方要有缓冲区
  -  发送方缓冲：未得到确认，可能需要重传； 
  -  接收方缓存：上层用户取用数据的速率≠接收到的数据速率；接收到的数据可 能乱序，排序交付（可靠）

### 滑动窗口(slide window)协议

**发送缓冲区** 

- 形式：内存中的一个区域，落入缓冲区的分组可以发送 
-  功能：用于存放已发送，但是没有得到确认的分组 
- 必要性：需要重发时可用

 **发送缓冲区中的分组** 

-  未发送的：落入发送缓冲区的分组，可以连续发送出去； 
-  已经发送出去的、等待对方确认的分组：发送缓冲区的分组只有得到确认 才能删除

前沿： 那些已发送但是未经确认分组的序号构成的空间

后沿：发送并确认的分组

![](https://s1.ax1x.com/2022/07/28/vCRVZF.png)

 发送窗口**后沿移动**

-  条件：收到老分组(后沿)的确认  
- 结果：发送缓冲区罩住新的分组，来了分组可以发 送 
-  移动的极限：不能够超过前沿

![](https://s1.ax1x.com/2022/07/28/vCRni9.png)

滑动窗口协议**发送过程**：

![](https://s1.ax1x.com/2022/07/28/vCRKR1.png)

 **接收窗口**的滑动和发送确认 

-  滑动： • 低序号的分组到来，接收窗口移动； 
- 高序号分组乱序到，缓存但不交付（因为要实现rdt，不允许失序），不滑动

![](https://s1.ax1x.com/2022/07/28/vCR3qO.png)



### GBN 和 SR协议处理接收窗口乱序

**Go-back-N:**

 GBN :接收窗口尺寸=1 

- 接收端：只能顺序接收 
- 发送端：从表现来看，一旦一个 分组没有发成功，如：0,1,2,3,4  ; 假如1未成功，234都发送出去 了，要返回1再发送；GB1
-  发送端拥有对最老的 未确认分组的定时器 ， 只需设置一个定时器 ， 当定时器到时时，**重传所有未确认分组**

**Selective Repeat:**

 SR: 接收窗口尺寸>1 

- 接收端：可以乱序接收 
-  发送端：发送0,1,2,3,4，一旦1 未成功，2,3,4,已发送，无需重 发，选择性发送1
-  发送方为每个未确认的 分组保持一个定时器 ， 当超时定时器到时，**只是重发到时的未确认分组**

**总结：**

![GBN和SR总结](https://s1.ax1x.com/2022/07/28/vCRoeU.png)

# 二、数据链路层

##  透明传输的实现方法

### 字符计数法

就是在帧的首部做计数，这个字符记录了当前帧有多少个字符。
缺点：如果在某一个帧内，标记位后面的某个字节的数据丢失，那么会影响后面的帧
比如3 1 1 和 4 2 2 2，如果前面的帧丢失变成 3 1，那么后面的4就会被补到前面变成 3 1 4导致错误

![image-20220929171313292](http://www.wanghongtao.xyz/typora/image-20220929171313292.png)

### 字符填充法

就是加头加尾分别标记开始结束，和零比特填充法（见下）对比，**开始和结束的对应的字符不一样**
但有可能出现数据内某段比特流数据正好**与标记字段重复**，从而导致误判断的情况

![image-20220929171651216](http://www.wanghongtao.xyz/typora/image-20220929171651216.png)

> ##### 解决方法：添加转义字符。即对于那些与标记字符重复的数据流，在它们的前面添加一段转义字符，这样接收方在解析帧时，看到这些转义字符就不会认为那些特殊的数据当成帧的开始/结束了

![image-20220929171741584](http://www.wanghongtao.xyz/typora/image-20220929171741584.png)

### 零比特填充法

1、在发送端，扫描整个信息段，只要出现5个1，就立即填入一个0.

2、在接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。发现连续5个1时，就把后面的0删除。

![image-20220929172314100](http://www.wanghongtao.xyz/typora/image-20220929172314100.png)

> 保证了透明传输：在传送的比特流中可以穿送任意比特组合，而不会引起对帧边界的判断错误



### 违规编码法

因为曼彻斯特编码不使用高-高，低-低来表示，所以如果使用高-高，低-低来表示帧起始和终止就**不会与数据冲突**

> 由于字节计数法中count字段的脆弱性以及字符填充实现上的复杂性和不兼容性
>
> 目前普遍使用的帧同步法是比特填充和违规编码法

## 检错编码（奇偶校验码，循环冗余码CRC）

### 奇偶校验码

奇偶校验：只需包含1个附加比特。

- 对于偶校验，选择一个值，使得所有比特中1出现偶数次。
- 对于奇校验，选择一个值，使得所有比特中1出现奇数次。接收方通过检测1出现的次数判断是否出现差错。如果出现偶数个比特差错，则检验不出
- 缺点：只能检测出1，3，5，7…等等奇位数错误，检测成功率位50%

### 循环冗余码CRC

发送方和接收方协商一个r+1比特的生成多项式(G)，要起其最高比特位为1。发送方通过在d比特的数据后附加r比特，使得整个(d+r)比特的值能够被G整除。接收方用G去除(d+r)比特，如果余数非0，则出现差错

![image-20220929173248612](http://www.wanghongtao.xyz/typora/image-20220929173248612.png)



> ”可靠传输“：数据链路层发送端发送什么，接收端就收到什么。
>
> 链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输

## 纠错编码（海明码）

一共分为四步

### **第一步 确认校验码位数r**

海明不等式
$$
2^{r} \geq k+r+1
$$
其中`r`为冗余信息位，k为信息位

比如要发送的数据：`D=101101`

- 数据的位数`k=6`
- 满足不等式的最小`r`为4
- 也就是`D=101101`的海明码应该有6+4=10位
- 其中原数据为6位，校验码4位

### 第二步 确定校验码和数据的位置

![image-20220929174439554](http://www.wanghongtao.xyz/typora/image-20220929174439554.png)

### 第三步 求出校验码的值

![image-20220929175241041](http://www.wanghongtao.xyz/typora/image-20220929175241041.png)

1. 先是通过二进制位确定有几位，本例一共有四位
2. 然后从p1开始看，看p1的二进制位的数值和所有信息位的对应位置的数值是否相同，然后找出来这些位

> 例如上图所标`D1,D2,D4,D5`它们的最后一位与`P1`相同
>
> 然后计算异或值，比如说这里`D1=1,D2=0,D4=1,D5=0`,就是p1要同时和**0**,**1**，**0**,**1**进行异或之后得到0
>
> 举例：**0**和**1**异或得1,1和**0**异或得1,1和**1**异或得0，那么p1和0异或得0，p1就是0了

3. 其他同理，按顺序计算出P2,P3,P4,然后填入表格

### 第四步 检测并纠错

就是和上面一样，将所有校验位进行运算，得出的结果的值就是错误的位

![image-20220929190012585](http://www.wanghongtao.xyz/typora/image-20220929190012585.png)





## 5、信道划分介质访问控制

**信道划分介质访问控制**：将使用介质的每个设备与来自同一信道上的其他设备的通信隔离开，把**时域**和**频域**资源合理地分配给网络上的设备。

**多路复用技术**：把多个信号组合在一条物理信道上进行传输，使得多个计算机或终端设备共享信道资源，提高信道利用率。

![](https://s1.ax1x.com/2022/09/09/vqX3i6.png)

### 频分多路复用

![](https://s1.ax1x.com/2022/09/09/vqjetP.png)

用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。频分复用的所有用户在同样的时间占用不同的带宽（频率带宽）资源。

优点：充分利用传输介质带宽，系统效率较高；由于技术比较成熟，实现也比较容易。

### 时分复用

![](https://s1.ax1x.com/2022/09/09/vqjthV.png)

将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙，所有用户轮流占用信道。



> 频分复用类似于操作系统中的并行
>
> 时分复用类似于操作系统中的并发

**改进的时分复用统计时长复用**

![](https://s1.ax1x.com/2022/09/09/vqjOgS.png)



每一个STDM帧中的时隙数小于连接在集中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后集中器按顺序依次扫描输入缓存，把缓存中输入数据放入STDM帧中，一个STDN帧满了就发出。STDM帧不是固定分配时隙，而是按需动态分配时隙。

# 

## 1、功能概述

数据链路层在**物理层提供服务的基础上向网络层提供服务**，最基本的服务就是将源自网络层的数据可靠地传输到相邻节点的目标网络层。其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成逻辑上无差错的数据链路，使之对网络层表现为一条无差别的链路。

## 2、链路层编址

以太网规定，一组电信号构成一个数据包，叫做”帧”（Frame）。

每一帧分成两个部分：标头（Head）和数据（Data）。

“标头”包含数据包的一些说明项，比如发送者、接受者、数据类型等等；”数据”则是数据包的具体内容。
 “标头”的长度，固定为18字节。”数据”的长度，最短为46字节，最长为1500字节。因此，整个”帧”最短为64字节，最长为1518字节。如果数据很长，就必须分割成多个帧进行发送。

## 3、MAC地址

上面提到，以太网数据包的”标头”，包含了发送者和接受者的信息。那么，发送者和接受者是如何标识呢？
 以太网规定，连入网络的所有设备，都必须具有”网卡”接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做**MAC地址**。

长度为6字节，共48比特，通常用十六进制表示法，地址的每个字节被表示为一对十六进制数

- 每个适配器具有一个唯一的MAC地址，不随位置发生变化
- 一台路由器的每个接口都有一个ARP模块和一个适配器
- MAC地址分配：当一个公司要生产适配器时，它支付象征性的费用购买一块MAC地址空间，IEEE分配这块地址时，固定前24比特，让公司自己为每个适配器生成后24比特的唯一组合

## ARP协议(地址解析协议)

通过MAC，我们定义了地址。但是我们紧接着就有一个问题，那就是一块网卡怎么会知道另一块网卡的MAC地址？
 答案就是ARP协议。

每个节点的ARP模块都在它的RAM中有一个ARP表，包含IP地址到MAC地址的映射关系，每个表项还包含TTL字段，表示表项过期时间（ARP表是自动创建的，如果某节点与子网断开连接，它的表项最终会从留在子网中的节点的表中删除。通常一个表项的过期时间是20分钟）

主机向其ARP模块提供一个IP地址，ARP模块返回IP地址对应的MAC地址

**ARP协议使用过程:Arp协议使用过程**：
检查ARP高速缓存，有对应表项则写入MAC帧，没有则用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装并广播ARP请求分组，同一局域网中所有主机都能收到该请求。目的主机收到请求后就会向源主机单播一个ARP响应分组，源主机收到后将此映射写入ARP缓存（10-20min更新一次）。

**ARP协议4种典型情况:Arp协议4种典型情况：**
1.主机A发给本网络上的主机B:用ARP找到主机B的硬件地址;
2.主机A发给另一网络上的主机B:用ARP找到本网络上一个路由器（网关）的硬件地址;

3.路由器发给本网络的主机A:用ARP找到主机A的硬件地址;
4.路由器发给另一网络的主机B:用ARP找到本网络上的一个路由器的硬件地址。

## 4、 随机接入协议

所有用户都可以随机发送信息，发送时可以占用全部带宽，理论上个人使用时比静态分配信道的速度更快

### 4.1ALOHA协议

帧到达节点时，立刻传输。如果发生碰撞，节点将立即(在完全传输碰撞帧后)以概率p重传。否则，等待一个帧传输时间，再以概率p重传。信道有效传输速率实际不是R bps，而是时隙ALOHA的一半

**时隙ALOHA协议**
 时间被划分为时隙，每个节点的时间同步，帧的传输只在时隙的开始时进行。如果发生碰撞，在下一个时隙开始时以概率p重传，否则等待一个时隙再以概率p重传…（信道有效传输速率实际不是R bps，而是0.37R bps）



### 4.2CSMA协议(载波侦听多路访问)

CS：载波侦听/监听，每一站在发送数据之前要检测一下总线上是否有其他计算机在发送数据。

MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。

协议思想：发送帧之前，监听信道。

![image-20220928101944992](http://www.wanghongtao.xyz/typora/image-20220928101944992.png)

<table><thead><tr><th>名称</th><th>描述</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>1-坚持CSMA</td><td>发送信息时监听信道，一空闲下来就立即传输，信道忙也一直监听，如果发送时冲突就等待随机时长之后再监听</td><td>立即发送，利用率高</td><td>如果多台设备同时监听，那么会发生冲突</td></tr><tr><td>非坚持CSMA</td><td>发送信息时监听信道，如果空闲就立即传输，信道忙就随机等待一段时间后再监听</td><td>冲突发生的几率减少</td><td>因为需要等待，所以利用率不高</td></tr><tr><td>p-坚持CSMA</td><td>发送信息时监听信道，空闲时以概率p进行传输，概率1-p不传输。信道忙就随机等待一段时间后再监听</td><td>冲突减少的同时效率也比较高</td><td>即使发生冲突也要坚持发送数据，资源被浪费</td></tr></tbody></table>



### 4.3CSMA/CD协议

因为链路实际有长短，发送数据需要时间，这个时间内可能就被其他节点当成空闲状态导致发生碰撞。

先侦听信道，如果没有其它节点在使用信道，则传输数据。但是有碰撞检测，如果发生碰撞，会停止传输剩下的数据，等待一个随机时间(通常比传输一帧短)后，再进行尝试。

知道自己发生碰撞的最长时间是2τ（两倍的**传播时延**），就是一去一回

CS（carrier sense ）：载波侦听/监听，每一个站在发送数据之前以及发送数据时都要检测一下总线上是否有其他计算机在发送数据。

MA（multiple access）：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。（总线型网络）

CD（collision detection）：碰撞检测（冲突检测），“边发送边监听”，适配器便发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据。

![image-20220928103324158](http://www.wanghongtao.xyz/typora/image-20220928103324158.png)

我们可以想到最小帧长的问题，因为如果帧太短，帧都发送完了才检测到碰撞导致停止，导致无法停止碰撞

![image-20220928103336883](http://www.wanghongtao.xyz/typora/image-20220928103336883.png)

### 4.4CSMA/CA协议

CA：（collision avoidance）也就是避免碰撞

为什么要有CSMA/CA？

- 无线局域网无法做到360度全面检测碰撞
- 隐蔽站 ，当A和C都检测不到信号，认为信道空闲时，同时向终端B发送数据帧，就会导致冲突。

CSMA/CA协议工作原理

**1、预约信道**：

发送数据之前，先检测信道是否空闲。

**2、RTS/CTS帧（可选）**

空闲则发出RTS（request to send），RTS包括发射端的地址、接收端的地址、下一份数据将持续发送等等信息：信道忙则等待。

接收端收到RTS，将相应CTS（clear to send）。

发送端收到CTS后，开始发送数据帧（同时预约信道：发送方告知其他站点自己要传多久数据）。

**3、ACK帧**

接收端收到数据帧后，将用CRC来检查数据是否正确，正确则相应ACK帧。

发送方收到ACK就可以进行下一个数据帧的发送，若煤油则一直重传至规定重发次数为止（采用二进制数退避算法来确定随机的推迟时间）



### 4.5CSMA/CD 与 CSMA/CA的区别

![image-20220928104726426](http://www.wanghongtao.xyz/typora/image-20220928104726426.png)

## 5、轮询访问介质访问控制

主要包括两大类，一个是**轮询协议**，另一个是**令牌传递协议**

###  5.1轮询协议

就是选出一个代表，让他控制所有的传输

三个问题

> - 轮询开销在随着服务的节点越多，需要用于查询是否发送数据发送的数据帧也就越多，会造成一定开销
> - 等待延迟就是因为这是轮流“邀请”，所以难免某个节点需要发送数据，但是主节点还在较远的需要里有需求的节点那边，导致需求得不到立即响应
> - 单点故障就是代表挂了

![image-20220928110442743](http://www.wanghongtao.xyz/typora/image-20220928110442743.png)

### 5.2令牌传递协议

在节点之间没有收发数据的需求时，令牌在节点之间循环。

发送数据的流程
①当一个节点需要时就可以获得这个令牌。然后修改这个令牌的状态（空闲->占用）
②再将令牌与数据帧结合，让其在节点构成的环之间流动
③不是目的地的节点收到令牌也不接受，直接略过，目标节点收到信息并复制一份到本地（传输完成），因为是个闭环，所以发送节点最后得到令牌
④最后，发送令牌的节点对令牌的内容进行检查，如果发现数据出错还要重新发一遍
问题基本和轮询协议相同
![image-20220928110650122](http://www.wanghongtao.xyz/typora/image-20220928110650122.png)

## 局域网

### 局域网的概念

局域网（Local Area Network）：简称LAN，是指在某一区域内由多台计算机互联成的计算机组使用广播信道。

特点：

- 覆盖范围小
- 使用专门铺设的传输介质，数据传输速率高（10Mb/s~10Gb/s）。
- 通信延迟短，误码率低，可靠性较高
- 各站为平等关系，共享传输信道
- 多采用分布式控制和广播式通信，能进行广播和组播。

决定局域网的主要要素为：网络拓扑，传输介质与介质访问控制方法

### 局域网的网络拓扑结构

常用的是**总线型拓扑**

![image-20220929191735208](http://www.wanghongtao.xyz/typora/image-20220929191735208.png)

### 局域网的传播介质

| 局域网     | 常用介质               |
| ---------- | ---------------------- |
| 有线局域网 | 双绞线，同轴电缆，光纤 |
| 无线局域网 | 电磁波                 |

### 局域网介质访问方法

1. CSMA/CD 常用于总线型局域网，也用于树形网络
2. 令牌总线 常用于总线型局域网，也用于树形网络（它是把总线型或者树形网络中的各个工作站按一定顺序如按接口地址大小排列成一个逻辑环。只有令牌持有者才能控制总线，才有发送信息的权利）。
3. 令牌环 用于环形局域网，如令牌环网

### 局域网的分类

1. 以太网 以太网是应用最为广泛的局域网，包括标准以太网（10Mbps）、快速以太网（100Mbps）、千兆以太网（1000Mbps）和10G以太网，他们都符合IEEE802.3系列标准规范。逻辑拓扑总线型，物理拓扑是星型或者拓展星型。使用CSMA/CD。
2. 令牌环网 物理上采用了星型拓扑结构，逻辑上是环形拓扑结构。
3. FDDI网（Flber Distributed Data Interface）
4. ATM网（Asynchronous Transfer Mode） 较新型的单元交换技术，使用53字节固定长度的单元进行交换。
5. 无线局域网（Wireless Local Area Network；WLAN） 采用IEEE 802.11标准

IEEE 802系列标准是IEEE 802 LAN/MAN 标准委员会制定的局域网、城域网技术标准。其中最广泛使用的有[以太网](https://baike.baidu.com/item/以太网?fromModule=lemma_inlink)、[令牌环](https://baike.baidu.com/item/令牌环?fromModule=lemma_inlink)、[无线局域网](https://baike.baidu.com/item/无线局域网?fromModule=lemma_inlink)等。这一系列标准中的每一个子标准都由委员会中的一个专门[工作组](https://baike.baidu.com/item/工作组/5103560?fromModule=lemma_inlink)负责。

###  IEEE802描述的局域网参考模型

IEEE802标准描述了局域网描述最低两层—物理层和数据链路层的功能以及与网络层的接口服务。其中数据链路层分为MAC子层和LLC子层。各层功能如下:

(1)物理层:与OSI/RM的物理层相对应,但所采用的具体协议标准的内容直接与传输介质有关。

(2)介质访问控制(MAC)层:具体管理通信实体接入信道而建立数据链路的控制过程。

(3)逻辑链路控制(LLC)层:提供一个或多个服务访问点,以复用的形式建立多点—多点之间的数据通信连接,并包括寻址、差错控制、顺序控制和流量控制等功能。

![image-20220929201147451](http://www.wanghongtao.xyz/typora/image-20220929201147451.png)

## 以太网

###  以太网概念

以太网（Ethernet）指的是由Xerox公司创建并由Xerox、Intel和DEC公司联合开发的基带总线局域网规范，是当今现有局域网采用的最为通用的通信协议标准。以太网使用CSMA/CD（载波监听多路访问及冲突检测）技术。

以太网有很多优点，以至于现在还处于统治地位

以太网的两个标准

DIX Ethernet V2：第一个局域网（以太网）规约。

IEEE 802.3：IEEE 802委员会802.3工作组制定的第一个IEEE的以太网标准。

**以太网提供无连接、不可靠的服务**

无连接：发送方和接收方之间无“握手过程”。

不可靠：不对发送方的数据帧编号，接收方不向发送方进行确认，差错直接丢弃，差错纠正由高层负责。

### 以太网的发展

粗同轴电缆-》细同轴电缆-》双绞线+集线器

物理拓扑：总线型-》星型

![image-20220929202622323](http://www.wanghongtao.xyz/typora/image-20220929202622323.png)

### 高速以太网

速率大于等于100MB/s的以太网称为高速以太网

1、100BASE-T以太网

在双绞线上传送100Mb/s基带信号的星型拓扑以太网，仍使用IEEE802.3的CSMA/CD协议。支持全双工和半双工，可在全双工方式下工作而无冲突。

2、吉比特以太网

在光纤或双绞线上传送1Gb/s信号

支持全双工和半双工，可在全双工方式下工作而无冲突。

3、吉比特

10吉比特以太网在光纤上传送10Gb/s信号。

## 无线局域网

![image-20220929203306040](http://www.wanghongtao.xyz/typora/image-20220929203306040.png)

### 两种无线局域网

![image-20220929203905810](http://www.wanghongtao.xyz/typora/image-20220929203905810.png)

![image-20220929203911370](http://www.wanghongtao.xyz/typora/image-20220929203911370.png)

## 广域网	

### 广域网的概述

广域网（WAN，Wide Area Network)，通常跨接很大的物理范围，所覆盖的范围从几十公里到几千公里，它能连接多个城市或国家，或横跨几个洲并能提供远距离通信，形成国际性的远程网络。

广域网的通信子网主要使用分组交换技术。广域网的通信子网可以利用公用分组交换网、卫星通信网和无线分组交换网，它将分布在不同地区的局域网或计算机系统互连起来，达到资源共享的目的。如因特网（Internet)是世界范围内最大的广域网。

![image-20220929204426000](http://www.wanghongtao.xyz/typora/image-20220929204426000.png)

### PPP协议（Point-to-Point Protocol）

PPP协议是目前**使用最广泛**的数据链路层协议，拨号基本都是PPP协议
PPP协议**仅支持全双工**链路

#### PPP协议需要满足的要求

![image-20220929204658881](http://www.wanghongtao.xyz/typora/image-20220929204658881.png)

#### PPP协议不需要满足的要求

- 纠错
- 流量控制
- 序号
- 不支持多点线路

####　PPP协议组成成分以及功能

1. 一个将IP数据报封装到串行链路（同步串行/异步串行）的方法。
2. 链路控制协议LCP：建立并维护数据链路层连接（身份验证）
3. 网络控制协议NCP：ppp可支持多种网络层协议，每个不同的网络层协议都要一个相应的NCP来配置，为网络层协议建立和配置逻辑连接。

####　PPP协议的帧格式

![image-20220929205445245](http://www.wanghongtao.xyz/typora/image-20220929205445245.png)

###  HDLC协议（High-Level Data Link Control）

#### HDLC协议概述

高级数据链路控制HDLC，是一个在同步网上传输数据、面向比特的数据链路层协议，它是由国际标准化组织ISO根据IBM公司的SDLC（SynchronousData Link Control）协议扩展开发而成的

数据报文可透明传输，用于实现透明传输的“0比特插入法”易于硬件实现

采用全双工通信

所有帧采用CRC检验，对信息帧进行顺序编号，可防止漏收或重份，传输可靠性高。

#### HDLC的三种站

**主站、从站、复合站**

- 主站的主要功能是发送命令（包括数据信息）帧、接收响应帧，并负责对整个链路的控制系统的初启、流程的控制、差错检测或恢复等。
- 从站的主要功能是接收由主站发来的命令帧，向主站发送响应帧，并且配合主站参与差错控制与差错恢复等链路控制。
- 复合站的主要功能是既能发送，又能接收命令帧和响应帧，并且负责整个链路的控制。

三种数据操作方式：

1. 正常响应方式
2. 异步平衡方式
3. 异步响应方式

#### HDLC的帧格式

![image-20220929211002954](http://www.wanghongtao.xyz/typora/image-20220929211002954.png)

#### PPP协议和HDLC协议对比

为什么HDLC协议更可靠，但是我们使用PPP协议？
 因为现在网络要求高，数据链路层本来就是不可靠的尽力传输，差错控制这些复杂的交给了TCP等

![image-20220929211221623](http://www.wanghongtao.xyz/typora/image-20220929211221623.png)

## 链路层设备

### 网桥（Bridge）

使用网桥时，由于网桥会根据mac地址进行过滤，所以**不会形成冲突域**

![image-20220929211405524](http://www.wanghongtao.xyz/typora/image-20220929211405524.png)

###  两种网桥

**透明网桥**

通过自学习来构建转发表。每一个通过网桥的数据包都会被记录下网桥收到数据时数据对应的地址和网桥自己的接口，通过许许多多的数据包的构造的缓存，网桥就可以知道哪个数据包在哪个接口，以后如果要穿数据包就知道要往哪个接口发送数据包了

**原路由网桥**

在发送时，直接将最佳路径放到帧首部。那么网桥如何获得最佳路径？通过广播方式向目标地址发送广播，此时可能会经过不同路由产生不同的路径，目标地址收到后再将每一条路径都发一个响应帧给网桥，网桥经过对比就知道哪个接口最快了

### 交换机

网桥接口越来越多，网桥就变成了交换机

交换机的任务是接收入链路层帧并将它们转发到出链路
 交换机自身对节点透明：某节点向另一节点寻址一个帧，顺利地将该帧发送进LAN，而不知道这个帧经过了某个交换机的接收与转发

1）交换机转发与过滤
 过滤：交换机决定一个帧是应该转发还是应该丢弃
 转发：决定一个帧应该被导向哪个接口

2）自学习(即插即用)
 交换机表是自动、动态、自治地建立的，没有来自网络管理员或配置协议的任何干预。换句话说，交换机是自学习的
 交换机表初始为空

**以太网交换机的两种交换方式**

- 直通式交换机： 查完目的地址（6B）就立即转发。延迟小，可靠性低，无法支持具有不同速率的端口的交换。
- 存储转发式交换机：将帧放入高速缓存，并检查是否正确，正确则转发，错误则丢弃。延迟大，可靠性高，可以支持具有不同速率的端口的交换。

### 冲突域和广播域

![image-20220929212624040](http://www.wanghongtao.xyz/typora/image-20220929212624040.png)
